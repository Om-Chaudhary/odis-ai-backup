# Cursor Rules for ODIS AI Web

Project-specific rules for the Nx monorepo.

## Quick Reference
- Docs index: `docs/README.md`
- Nx inventory (generated): `docs/reference/NX_PROJECTS.md` (`pnpm docs:nx`)
- Project guide for AI assistants: `CLAUDE.md`
- Testing strategy: `docs/testing/TESTING_STRATEGY.md`

## Workspace Overview
- Framework: Next.js 15 (App Router), React Server Components by default
- Language: TypeScript (strict)
- Styling: Tailwind CSS 4 + shadcn/ui (Radix)
- Data: Supabase (PostgreSQL) with service client for admin paths
- Nx layout: `apps/web` + libraries in `libs/*` (api, db, vapi, idexx, logger, utils, types, services, validators, clinics, constants, crypto, qstash, resend, email, ui)
- Tags: use `type:*`, `scope:*`, `platform:*` in `project.json` for new projects

## Key Patterns
### Server Actions vs API Routes
- Prefer Server Actions for internal flows
- Use API Routes only for webhooks/external integrations

### Supabase Clients
- Standard client: `createClient()` (RLS, cookies)
- Service client: `createServiceClient()` (bypasses RLS, admin only)

### React Hooks
- Use ref pattern for polling/interval stability
- Minimize `"use client"`; default to Server Components

## Nx & Documentation
- Keep docs inside `docs/` following `docs/README.md`
- Update section READMEs when adding docs; match scope to Nx tags
- Regenerate Nx inventories with `pnpm docs:nx` (do not hand-edit generated files)

## Visual Testing
- Use Playwright MCP when possible
- Navigate: `browser_navigate("http://localhost:3000/dashboard")`
- Screenshot: `browser_take_screenshot("name.png")`
- Snapshot: `browser_snapshot()` for accessibility tree
- See `docs/cursor-commands/browser-testing/visual-test-commands.md`

## Common Workflows
- Component development: `npx shadcn@latest add [component]`; test visually
- API testing: `browser_network_requests()`; `browser_console_messages()`
- Debugging: filter console errors and inspect network; see `docs/cursor-commands/debugging/debug-commands.md`

## Code Style
- TypeScript strict; prefer interfaces over types
- Formatting: Prettier (Tailwind plugin) runs on commit
- Naming: lowercase-with-dashes for folders, PascalCase for components

## Important Notes
1. Supabase service client bypasses RLS—use only where required
2. Use refs to avoid unstable hook dependencies
3. Default to Server Components; opt into `"use client"` only when needed
4. `NEXT_PUBLIC_*` variables are public—never store secrets there

## Links
- Docs index: `./docs/README.md`
- AI assistant guide: `./CLAUDE.md`
- Cursor commands: `./docs/cursor-commands/README.md`
- Testing strategy: `./docs/testing/TESTING_STRATEGY.md`
