<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeedsAttentionCard Demo - ODIS AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for attention cards */
        .attention-card {
            transition: all 0.3s ease;
        }
        .attention-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .critical-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto p-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">
                ðŸŽ¯ NeedsAttentionCard Demo
            </h1>
            <p class="text-xl text-gray-600 mb-4">
                Test the new attention card functionality with various scenarios
            </p>
            <div class="bg-blue-100 text-blue-800 px-6 py-3 rounded-lg inline-block">
                âœ¨ This demonstrates the new side panel card that replaces the summary column
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Scenario Selector -->
            <div class="space-y-4">
                <h2 class="text-xl font-semibold text-gray-900">Test Scenarios</h2>
                <div class="space-y-2" id="scenario-buttons">
                    <!-- Buttons will be generated by JavaScript -->
                </div>
            </div>

            <!-- Card Preview -->
            <div class="lg:col-span-2 space-y-4">
                <h2 class="text-xl font-semibold text-gray-900">Card Preview</h2>
                <div class="p-6 bg-white rounded-lg border shadow-sm">
                    <div class="text-sm text-gray-600 mb-4">
                        This is how the card appears in the outbound detail side panel:
                    </div>
                    <div id="card-preview">
                        <!-- Card will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- Technical Details -->
            <div class="space-y-4">
                <h2 class="text-xl font-semibold text-gray-900">Technical Details</h2>

                <div class="bg-white p-4 rounded-lg border">
                    <h3 class="font-semibold mb-2 text-sm">Input Data</h3>
                    <pre id="input-data" class="bg-gray-100 p-3 rounded text-xs overflow-auto max-h-48"></pre>
                </div>

                <div class="bg-white p-4 rounded-lg border">
                    <h3 class="font-semibold mb-2 text-sm">Implementation Notes</h3>
                    <div class="text-xs space-y-2">
                        <div><strong>Location:</strong> Outbound detail side panel above CallSummary</div>
                        <div><strong>Visibility:</strong> Only shows when hasActionableAttentionTypes() returns true</div>
                        <div><strong>Title:</strong> Uses attention type mapping for user-friendly titles</div>
                        <div><strong>Content:</strong> Shows context and action needed (no severity badge)</div>
                        <div><strong>Priority:</strong> Single issue per card (highest priority from structured output)</div>
                        <div><strong>Fallback:</strong> Gracefully handles legacy unstructured summaries</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Integration Instructions -->
        <div class="mt-8 bg-white p-6 rounded-lg border shadow-sm">
            <h2 class="text-xl font-semibold mb-4">How to Test in Production Dashboard</h2>
            <div class="space-y-4">
                <div>
                    <h3 class="font-semibold mb-2">Steps to see this in action:</h3>
                    <ol class="list-decimal list-inside space-y-2 text-sm">
                        <li>Navigate to the outbound dashboard: <code class="bg-gray-100 px-2 py-1 rounded">/dashboard/[clinicSlug]/outbound</code></li>
                        <li>Click on a case that has attention flags (attention_types is not empty)</li>
                        <li>The NeedsAttentionCard will appear at the top of the right side panel</li>
                        <li>The summary column has been removed from the table for a cleaner layout</li>
                    </ol>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-semibold mb-2 text-blue-900">What Changed:</h3>
                    <ul class="list-disc list-inside space-y-1 text-sm text-blue-800">
                        <li>Removed "Summary" column from outbound table</li>
                        <li>Added NeedsAttentionCard component to side panel above call summary</li>
                        <li>Card shows structured attention information with severity-based styling</li>
                        <li>Supports both new structured format and legacy unstructured summaries</li>
                        <li>Only displays when case actually needs attention</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Demo scenarios
        const scenarios = [
            {
                id: "critical-emergency",
                name: "Critical Emergency",
                description: "Pet showing severe symptoms requiring immediate emergency care",
                attentionTypes: ["emergency_signs"],
                attentionSeverity: "critical",
                attentionSummary: "**[EMERGENCY] - Pet showing signs of bloat with distended abdomen: Contact emergency vet immediately - do not wait**"
            },
            {
                id: "urgent-callback",
                name: "Urgent Callback",
                description: "Owner dissatisfied with treatment, needs follow-up within 24 hours",
                attentionTypes: ["owner_dissatisfaction"],
                attentionSeverity: "urgent",
                attentionSummary: "**[COMPLAINT] - Owner unhappy with billing charges and treatment outcome: Schedule callback within 24 hours to discuss concerns**"
            },
            {
                id: "routine-medication",
                name: "Routine Medication Question",
                description: "Standard question about medication administration",
                attentionTypes: ["medication_question"],
                attentionSeverity: "routine",
                attentionSummary: "**[MEDICATION] - Confusion about antibiotic timing with meals: Clarify dosing schedule during business hours**"
            },
            {
                id: "appointment-needed",
                name: "Appointment Needed",
                description: "Follow-up appointment required for post-surgical care",
                attentionTypes: ["appointment_needed"],
                attentionSeverity: "urgent",
                attentionSummary: "**[FOLLOW-UP] - Post-surgical complications observed: Schedule recheck appointment within 48 hours to assess healing**"
            },
            {
                id: "legacy-format",
                name: "Legacy Unstructured Format",
                description: "Example of old unstructured attention summary",
                attentionTypes: ["callback_request"],
                attentionSeverity: "urgent",
                attentionSummary: "Owner called back 3 times asking about Rocky's discharge instructions. Seems confused about the medication schedule and when to return for suture removal. Please call back to clarify instructions."
            },
            {
                id: "no-attention",
                name: "No Attention Needed",
                description: "Normal case without attention flags",
                attentionTypes: [],
                attentionSeverity: "routine",
                attentionSummary: null
            }
        ];

        let currentScenario = scenarios[0];

        // Attention type mapping
        const ATTENTION_TYPE_LABELS = {
            medication_question: 'Medication Question',
            callback_request: 'Callback Request',
            appointment_needed: 'Appointment Needed',
            health_concern: 'Health Concern',
            emergency_signs: 'Emergency Signs',
            owner_dissatisfaction: 'Owner Dissatisfaction',
            follow_up_needed: 'Follow-up Needed',
            billing_question: 'Billing Question',
            treatment_concern: 'Treatment Concern',
            side_effects: 'Side Effects',
            care_instructions: 'Care Instructions',
            urgent_callback: 'Urgent Callback',
            recheck_needed: 'Recheck Needed',
            complications: 'Complications',
        };

        // Get user-friendly title from attention types
        function getAttentionTitle(attentionTypes) {
            if (!attentionTypes || attentionTypes.length === 0) {
                return 'Attention Needed';
            }
            // Take the first (highest priority) attention type
            const primaryType = attentionTypes[0];
            return ATTENTION_TYPE_LABELS[primaryType] || 'Attention Needed';
        }

        // Simple attention parser
        function parseAttentionSummary(summary) {
            if (!summary) return null;

            // Try structured format
            const structuredMatch = summary.match(/\*\*\[([^\]]+)\] - ([^:]+): ([^*]+)\*\*/);
            if (structuredMatch) {
                return {
                    reason: structuredMatch[1],
                    context: structuredMatch[2],
                    action: structuredMatch[3],
                    isStructured: true
                };
            }

            // Legacy format
            return {
                reason: "ATTENTION",
                context: "Attention needed",
                action: summary.length > 100 ? summary.substring(0, 100) + "..." : summary,
                isStructured: false
            };
        }

        // Render attention card
        function renderAttentionCard(scenario) {
            const cardPreview = document.getElementById('card-preview');

            if (scenario.attentionTypes.length === 0) {
                cardPreview.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        âœ… No attention card displayed - case doesn't need attention
                    </div>
                `;
                return;
            }

            const parsed = parseAttentionSummary(scenario.attentionSummary);
            const title = getAttentionTitle(scenario.attentionTypes);

            const severityColors = {
                critical: { bg: "bg-red-50", border: "border-red-200", borderLeft: "border-l-red-500" },
                urgent: { bg: "bg-orange-50", border: "border-orange-200", borderLeft: "border-l-orange-500" },
                routine: { bg: "bg-blue-50", border: "border-blue-200", borderLeft: "border-l-blue-500" }
            };

            const colors = severityColors[scenario.attentionSeverity];

            cardPreview.innerHTML = `
                <div class="attention-card ${colors.bg} ${colors.border} ${colors.borderLeft} border border-l-4 rounded-lg p-4 space-y-3 ${scenario.attentionSeverity === 'critical' ? 'critical-pulse' : ''}">
                    <!-- Main title from attention type -->
                    <div class="flex items-center gap-2">
                        <h3 class="font-semibold text-gray-900">${title}</h3>
                    </div>

                    ${parsed ? `
                        <div class="space-y-2">
                            ${parsed.context && parsed.context !== 'Attention needed' ? `
                                <div>
                                    <h4 class="text-sm font-medium text-gray-700 mb-1">Context</h4>
                                    <p class="text-sm text-gray-600">${parsed.context}</p>
                                </div>
                            ` : ''}

                            <div>
                                <h4 class="text-sm font-medium text-gray-700 mb-1">Action Needed</h4>
                                <p class="text-sm text-gray-900 font-medium">${parsed.action}</p>
                            </div>
                        </div>
                    ` : `
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-1">Details</h4>
                            <p class="text-sm text-gray-600">Review case and address attention items</p>
                        </div>
                    `}
                </div>
            `;
        }

        // Update input data display
        function updateInputData(scenario) {
            document.getElementById('input-data').textContent = JSON.stringify({
                attentionTypes: scenario.attentionTypes,
                attentionSeverity: scenario.attentionSeverity,
                attentionSummary: scenario.attentionSummary
            }, null, 2);
        }

        // Render scenario buttons
        function renderScenarioButtons() {
            const container = document.getElementById('scenario-buttons');
            container.innerHTML = scenarios.map(scenario => {
                const severityColors = {
                    critical: "border-red-200 bg-red-50 hover:bg-red-100",
                    urgent: "border-orange-200 bg-orange-50 hover:bg-orange-100",
                    routine: "border-blue-200 bg-blue-50 hover:bg-blue-100"
                };

                return `
                    <button
                        onclick="selectScenario('${scenario.id}')"
                        class="w-full text-left p-3 rounded-lg border transition-all ${
                            currentScenario.id === scenario.id ? 'border-blue-500 bg-blue-50' : severityColors[scenario.attentionSeverity] + ' border-gray-200'
                        }"
                    >
                        <div class="font-medium text-gray-900">${scenario.name}</div>
                        <div class="text-sm text-gray-500 mt-1">${scenario.description}</div>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="px-2 py-1 rounded text-xs font-medium ${
                                scenario.attentionSeverity === 'critical' ? 'bg-red-100 text-red-800' :
                                scenario.attentionSeverity === 'urgent' ? 'bg-orange-100 text-orange-800' :
                                'bg-blue-100 text-blue-800'
                            }">${scenario.attentionSeverity}</span>
                            <span class="text-xs text-gray-500">${scenario.attentionTypes.length} types</span>
                        </div>
                    </button>
                `;
            }).join('');
        }

        // Select scenario
        function selectScenario(scenarioId) {
            currentScenario = scenarios.find(s => s.id === scenarioId);
            renderAttentionCard(currentScenario);
            updateInputData(currentScenario);
            renderScenarioButtons(); // Re-render to update active state
        }

        // Initialize
        renderScenarioButtons();
        renderAttentionCard(currentScenario);
        updateInputData(currentScenario);
    </script>
</body>
</html>